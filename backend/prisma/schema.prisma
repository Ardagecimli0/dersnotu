generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id            String             @id @default(uuid())
  email         String             @unique
  username      String             @unique
  passwordHash  String
  role          String             @default("STUDENT")
  currentPoints Int                @default(0)
  totalPoints   Int                @default(0)
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  bio           String?
  profileImage  String?
  notes         Note[]
  transactions  PointTransaction[]

  @@map("users")
}

model Grade {
  id      Int      @id @default(autoincrement())
  name    String   @unique
  slug    String   @unique
  lessons Lesson[]

  @@map("grades")
}

model Lesson {
  id      Int     @id @default(autoincrement())
  name    String
  slug    String
  gradeId Int
  grade   Grade   @relation(fields: [gradeId], references: [id])
  topics  Topic[]

  @@unique([gradeId, slug])
  @@map("lessons")
}

model Topic {
  id       Int    @id @default(autoincrement())
  name     String
  slug     String
  lessonId Int
  notes    Note[]
  lesson   Lesson @relation(fields: [lessonId], references: [id])

  @@unique([lessonId, slug])
  @@map("topics")
}

model Note {
  id              String   @id @default(uuid())
  title           String   @db.Text
  content         String?  @db.Text
  fileUrl         String?
  slug            String   @unique
  status          String   @default("PENDING")
  rejectionReason String?  @db.Text
  viewCount       Int      @default(0)
  likeCount       Int      @default(0)
  uploaderId      String
  topicId         Int
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  topic           Topic    @relation(fields: [topicId], references: [id])
  uploader        User     @relation(fields: [uploaderId], references: [id])

  @@index([status])
  @@index([topicId], map: "notes_topicId_fkey")
  @@index([uploaderId], map: "notes_uploaderId_fkey")
  @@map("notes")
}

model PointTransaction {
  id          String   @id @default(uuid())
  userId      String
  amount      Int
  type        String
  description String?
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id])

  @@index([userId], map: "point_transactions_userId_fkey")
  @@map("point_transactions")
}
